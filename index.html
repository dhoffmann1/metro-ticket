<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulated Metro Ticket</title>
    <!-- Load Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for authenticity, though Inter is used as default */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #2c3e50; /* Darker background to simulate device frame */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* ---------------------------------- */
        /* Custom Animation for Scrolling Bar */
        /* ---------------------------------- */

        /* Keyframes for continuous Left-to-Right horizontal scroll,
           scrolling exactly one full container width (100%) */
        @keyframes colorScroll {
            from { background-position: 0% 0; }
            to { background-position: 100% 0; }
        }

        .header-section {
            width: 100%;
            height: 128px; /* Half of the total header height (256px) */
            background-size: 200% 100%; /* Double the width for seamless scrolling */
            background-repeat: repeat-x;
            animation: colorScroll 12s linear infinite;
        }

        /* Top Header: Light Blue and Light Red */
        .header-top {
            background-image:
                linear-gradient(90deg, #2d5dc2 0%, #2d5dc2 50%, #e82449 50%, #e82449 100%);
        }

        /* Bottom Header: Dark Blue and Dark Red */
        .header-bottom {
            background-image:
                linear-gradient(90deg, #1f4095 0%, #1f4095 50%, #c41e3a 50%, #c41e3a 100%);
        }

        /* ---------------------------------- */
        /* Absolute Position for METRO Text */
        /* ---------------------------------- */
        .header-wrapper {
            position: relative;
            height: 256px; /* Combined height of header-top (128) + header-bottom (128) */
            overflow: hidden;
            z-index: 10;
        }

        .metro-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Center horizontally and vertically */
            z-index: 20; /* Ensure text is above all color layers */
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* ---------------------------------- */
        /* Main Content Styling with Image */
        /* ---------------------------------- */
        .main-ticket-area {
            background:
                url('background.jpg') no-repeat center / 100% auto,
                linear-gradient(to bottom, #d5eaff, #c8e3ff);
            margin-top: 0;
            position: relative;
        }

        /* ---------------------------------- */
        /* Dynamic Time Bar Styling */
        /* ---------------------------------- */
        .time-bar {
            background-color: #0b73b5; /* Dark blue background matching the original image's date bar */
            color: white;
            /* INCREASED: Padding for taller bar, font size for larger text */
            padding: 1rem 1rem;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
        }

        /* Home Screen Specific Styling */
        #home-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            background-color: #ecf0f1; /* Light gray background for home screen */
        }

        .ticket-button {
            padding: 1.5rem 3rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            background-color: #2980b9; /* Darker blue button color */
            border-radius: 0.75rem; /* Rounded corners */
            box-shadow: 0 6px #1f6899; /* Shadow for 3D press effect */
            transition: all 0.1s;
        }

        .ticket-button:active {
            transform: translateY(3px);
            box-shadow: 0 3px #1f6899;
        }

    </style>
</head>
<body class="p-0 m-0">
    <div id="app-container" class="w-full max-w-sm h-[85vh] bg-white shadow-2xl overflow-hidden flex flex-col">

        <!-- This is the main content target for conditional rendering -->
        <div id="app-content" class="h-full flex flex-col">
            <!-- Content will be injected here by JavaScript -->
        </div>

    </div>

    <script>
        // State variable to track the current view: 'home' or 'ticket'
        let appState = 'home';
        const appContent = document.getElementById('app-content');

        // Global variable for time display element
        let timeDisplay = null;

        /**
         * Calculates the ticket expiration time (3 hours from now)
         * and formats it as MM/DD/YYYY at HH:MM PM/AM.
         */
        function updateTicketTime() {
            // Ensure timeDisplay element exists before trying to update it
            if (!timeDisplay) {
                timeDisplay = document.getElementById('time-display');
            }
            if (!timeDisplay) return;

            // Get the current date and time
            const now = new Date();
            // Calculate the expiration time (3 hours later)
            now.setHours(now.getHours() + 3);

            // Options for date formatting
            const dateOptions = {
                month: '2-digit',
                day: '2-digit',
                year: 'numeric'
            };

            // Options for time formatting
            const timeOptions = {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            };

            // Format the date and time strings
            const formattedDate = now.toLocaleDateString('en-US', dateOptions);
            const formattedTime = now.toLocaleTimeString('en-US', timeOptions);

            // Construct the final string and update the display
            timeDisplay.textContent = `${formattedDate} at ${formattedTime.replace(' ', ' ')}`;
        }

        /**
         * Renders the home screen with the "Open Ticket" button.
         */
        function renderHome() {
            appContent.innerHTML = `
                <div id="home-screen">
                    <h1 class="text-3xl font-semibold mb-8 text-gray-700">Metro Transit App</h1>
                    <button class="ticket-button" onclick="showTicket()">
                        Open Ticket
                    </button>
                </div>
            `;
            appState = 'home';
        }

        /**
         * Renders the full ticket view.
         */
        function renderTicket() {
            appContent.innerHTML = `
                <!-- 1. Scrolling Header Bar (Blue/Red) -->
                <header class="header-wrapper">

                    <!-- Top Color Half (Light Blue / Light Red) -->
                    <div class="header-section header-top"></div>

                    <!-- Bottom Color Half (Dark Blue / Dark Red) -->
                    <div class="header-section header-bottom"></div>

                    <!-- Absolute Centered Text -->
                    <h1 class="metro-text text-4xl font-extrabold text-white tracking-widest">METRO</h1>

                </header>

                <!-- 2. Main Ticket Body (Static Image) -->
                <main class="main-ticket-area flex-grow flex flex-col justify-end p-0">
                    <!-- This area now relies on the background image for "LOCAL SINGLE RIDE" and QR code -->
                </main>

                <!-- 3. Dynamic Date/Time Bar -->
                <div class="time-bar">
                    <p id="time-display"></p>
                </div>

                <!-- 4. Footer Bar -->
                <footer class="bg-[#1f4095] text-white p-5 text-center">
                    <p id="expiration-text" class="text-xl font-semibold tracking-wider uppercase">
                        Ticket Expiration
                    </p>
                </footer>
            `;
            appState = 'ticket';

            // Re-identify the timeDisplay element now that the ticket HTML is rendered
            timeDisplay = document.getElementById('time-display');

            // CRITICAL: Calculate and display the time NOW when the ticket is opened
            updateTicketTime();
        }

        /**
         * Public function to switch to the ticket view and manage history.
         */
        window.showTicket = function() {
            // Only push a state if we are currently on the home screen (to prevent duplicate history entries)
            if (appState === 'home') {
                history.pushState({ screen: 'ticket' }, 'Ticket Active');
            }
            renderTicket();
        }

        /**
         * Public function to switch back to the home view.
         */
        window.showHome = function() {
            renderHome();
        }

        // --- Back Button Listener ---
        // This listens for the user clicking the browser's back button
        // (which simulates the physical back button on Android).
        window.onpopstate = function(event) {
            // Check if we are moving away from a 'ticket' state
            if (appState === 'ticket') {
                renderHome();
            }
        };

        // Initialize the application to the home screen
        document.addEventListener('DOMContentLoaded', () => {
             // Use replaceState to set the initial state without adding a back button entry
            history.replaceState({ screen: 'home' }, 'Metro Home');
            renderHome();
        });
    </script>
</body>
</html>
